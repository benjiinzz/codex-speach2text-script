#!/usr/bin/env bash
set -euo pipefail

UID_NUM="$(id -u)"
XDG_RUNTIME_DIR="${XDG_RUNTIME_DIR:-/run/user/$UID_NUM}"
RUNDIR="$XDG_RUNTIME_DIR/codex_ptt"
PIDFILE="$RUNDIR/rec.pid"

mkdir -p "$RUNDIR"

if [[ -f "$PIDFILE" ]]; then
  pid="$(cat "$PIDFILE" 2>/dev/null || true)"
  if [[ -n "${pid:-}" ]] && kill -0 "$pid" 2>/dev/null; then
    exec ~/.local/bin/codex_ptt_stop
  fi
fi

exec ~/.local/bin/codex_ptt_start
